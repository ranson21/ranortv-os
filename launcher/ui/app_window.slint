// Apple TV-style Media OS Interface
import { Button, VerticalBox, HorizontalBox, GridBox, ScrollView } from "std-widgets.slint";

// App item structure
export struct AppItem {
    id: string,
    name: string,
    description: string,
    icon_path: string,
    category: string,
}

// Apple TV-style app tile component
component AppTile inherits Rectangle {
    in property <AppItem> app;
    in property <bool> focused: false;
    in property <bool> large: false;
    
    callback clicked();
    
    width: large ? 280px : 200px;
    height: large ? 160px : 120px;
    border-radius: 8px;
    background: focused ? #ffffff20 : #ffffff10;
    border-width: focused ? 2px : 0px;
    border-color: #ffffff80;
    
    // Hover/focus animation
    animate background { duration: 200ms; }
    animate border-width { duration: 200ms; }
    animate scale { duration: 200ms; }
    
    scale: focused ? 1.05 : 1.0;
    
    // Drop shadow effect
    Rectangle {
        x: 2px;
        y: 2px;
        width: parent.width;
        height: parent.height;
        border-radius: parent.border-radius;
        background: #00000040;
        z: -1;
    }
    
    VerticalBox {
        padding: 12px;
        spacing: 8px;
        
        // App icon placeholder
        Rectangle {
            height: large ? 80px : 60px;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            
            Text {
                text: app.name.slice(0, 1);
                color: white;
                font-size: large ? 32px : 24px;
                font-weight: 600;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // App name
        Text {
            text: app.name;
            color: white;
            font-size: large ? 16px : 14px;
            font-weight: 500;
            horizontal-alignment: center;
            overflow: elide;
        }
    }
    
    TouchArea {
        clicked => {
            root.clicked();
        }
    }
}

// Top navigation bar component
component TopBar inherits Rectangle {
    in property <int> current-tab;
    callback tab-clicked(int);
    
    height: 80px;
    background: #00000060;
    
    HorizontalBox {
        padding: 20px;
        spacing: 40px;
        alignment: center;
        
        // Logo/Title
        Text {
            text: "Media OS";
            color: white;
            font-size: 24px;
            font-weight: 700;
            horizontal-alignment: center;
        }
        
        Rectangle { width: 1fr; } // Spacer
        
        // Tab buttons
        HorizontalBox {
            spacing: 30px;
            
            TabButton {
                text: "Home";
                active: current-tab == 0;
                clicked => { root.tab-clicked(0); }
            }
            
            TabButton {
                text: "Apps";
                active: current-tab == 1;
                clicked => { root.tab-clicked(1); }
            }
            
            TabButton {
                text: "Store";
                active: current-tab == 2;
                clicked => { root.tab-clicked(2); }
            }
            
            TabButton {
                text: "Settings";
                active: current-tab == 3;
                clicked => { root.tab-clicked(3); }
            }
        }
    }
}

// Tab button component
component TabButton inherits Rectangle {
    in property <string> text;
    in property <bool> active: false;
    callback clicked();
    
    width: 80px;
    height: 40px;
    border-radius: 20px;
    background: active ? #ffffff30 : transparent;
    
    animate background { duration: 200ms; }
    
    Text {
        text: root.text;
        color: active ? white : #ffffff80;
        font-size: 14px;
        font-weight: active ? 600 : 400;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
    
    TouchArea {
        clicked => { root.clicked(); }
    }
}

// Featured section component (Apple TV style hero)
component FeaturedSection inherits Rectangle {
    in property <[AppItem]> apps;
    callback app-clicked(string);
    
    height: 400px;
    
    VerticalBox {
        spacing: 20px;
        
        Text {
            text: "Featured";
            color: white;
            font-size: 28px;
            font-weight: 700;
            horizontal-alignment: left;
        }
        
        ScrollView {
            viewport-height: 320px;
            
            HorizontalBox {
                spacing: 20px;
                padding: 10px;
                
                for app[i] in apps: AppTile {
                    app: app;
                    large: i == 0; // First app is larger
                    clicked => { root.app-clicked(app.id); }
                }
            }
        }
    }
}

// Grid section for apps
component AppGrid inherits Rectangle {
    in property <[AppItem]> apps;
    in property <string> title;
    callback app-clicked(string);
    
    VerticalBox {
        spacing: 20px;
        
        Text {
            text: title;
            color: white;
            font-size: 24px;
            font-weight: 600;
            horizontal-alignment: left;
        }
        
        ScrollView {
            GridBox {
                spacing: 20px;
                
                for app[i] in apps: AppTile {
                    app: app;
                    row: floor(i / 5);
                    col: mod(i, 5);
                    clicked => { root.app-clicked(app.id); }
                }
            }
        }
    }
}

// Settings panel
component SettingsPanel inherits Rectangle {
    VerticalBox {
        spacing: 30px;
        padding: 40px;
        
        Text {
            text: "Settings";
            color: white;
            font-size: 32px;
            font-weight: 700;
        }
        
        VerticalBox {
            spacing: 20px;
            
            SettingsItem {
                title: "Display & Sound";
                description: "Resolution, HDR, Audio output";
            }
            
            SettingsItem {
                title: "Network";
                description: "Wi-Fi, Ethernet, VPN";
            }
            
            SettingsItem {
                title: "Apps";
                description: "Manage installed applications";
            }
            
            SettingsItem {
                title: "System";
                description: "Updates, Storage, Restart";
            }
            
            SettingsItem {
                title: "Privacy & Security";
                description: "Permissions, Parental controls";
            }
        }
    }
}

// Settings item component
component SettingsItem inherits Rectangle {
    in property <string> title;
    in property <string> description;
    
    height: 80px;
    border-radius: 8px;
    background: #ffffff10;
    
    HorizontalBox {
        padding: 20px;
        spacing: 20px;
        
        VerticalBox {
            spacing: 5px;
            
            Text {
                text: title;
                color: white;
                font-size: 18px;
                font-weight: 600;
            }
            
            Text {
                text: description;
                color: #ffffff80;
                font-size: 14px;
            }
        }
        
        Rectangle { width: 1fr; } // Spacer
        
        Text {
            text: ">";
            color: #ffffff60;
            font-size: 20px;
            vertical-alignment: center;
        }
    }
    
    TouchArea {
        // Handle settings item click
    }
}

// Main application window
export component AppWindow inherits Window {
    // Properties
    in-out property <int> current-tab: 0;
    in-out property <[AppItem]> featured-apps;
    in-out property <[AppItem]> installed-apps;
    in-out property <[AppItem]> store-apps;
    
    // Callbacks
    callback launch-app(string);
    callback navigate(string);
    callback switch-tab(int);
    callback refresh-store();
    
    // Window properties
    title: "Media OS";
    background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    
    // Keyboard handling
    FocusScope {
        key-pressed(event) => {
            if (event.text == Key.UpArrow) {
                root.navigate("up");
                return accept;
            } else if (event.text == Key.DownArrow) {
                root.navigate("down");
                return accept;
            } else if (event.text == Key.LeftArrow) {
                root.navigate("left");
                return accept;
            } else if (event.text == Key.RightArrow) {
                root.navigate("right");
                return accept;
            } else if (event.text == Key.Return) {
                root.navigate("select");
                return accept;
            }
            return reject;
        }
        
        VerticalBox {
            // Top navigation
            TopBar {
                current-tab: root.current-tab;
                tab-clicked(index) => {
                    root.current-tab = index;
                    root.switch-tab(index);
                }
            }
            
            // Main content area
            Rectangle {
                height: 1fr;
                
                ScrollView {
                    padding: 40px;
                    
                    VerticalBox {
                        spacing: 40px;
                        
                        // Content based on current tab
                        if current-tab == 0: VerticalBox {
                            spacing: 40px;
                            
                            FeaturedSection {
                                apps: featured-apps;
                                app-clicked(id) => { root.launch-app(id); }
                            }
                            
                            AppGrid {
                                title: "Recently Used";
                                apps: installed-apps;
                                app-clicked(id) => { root.launch-app(id); }
                            }
                        }
                        
                        if current-tab == 1: AppGrid {
                            title: "All Apps";
                            apps: installed-apps;
                            app-clicked(id) => { root.launch-app(id); }
                        }
                        
                        if current-tab == 2: VerticalBox {
                            spacing: 30px;
                            
                            HorizontalBox {
                                Text {
                                    text: "App Store";
                                    color: white;
                                    font-size: 32px;
                                    font-weight: 700;
                                }
                                
                                Rectangle { width: 1fr; }
                                
                                Button {
                                    text: "Refresh";
                                    clicked => { root.refresh-store(); }
                                }
                            }
                            
                            AppGrid {
                                title: "Available Apps";
                                apps: store-apps;
                                app-clicked(id) => { root.launch-app(id); }
                            }
                        }
                        
                        if current-tab == 3: SettingsPanel {
                        }
                    }
                }
            }
        }
    }
}