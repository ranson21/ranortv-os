// Apple TV-style Media OS Interface
import { Button, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";

// App item structure
export struct AppItem {
    id: string,
    name: string,
    description: string,
    icon_path: string,
    category: string,
}

// Apple TV-style app tile component
component AppTile inherits Rectangle {
    in property <AppItem> app;
    in property <bool> focused: false;
    in property <bool> large: false;
    callback clicked();
    width: large ? 280px : 200px;
    height: large ? 160px : 120px;
    border-radius: 8px;
    background: focused ? #ffffff20 : #ffffff10;
    border-width: focused ? 2px : 0px;
    border-color: #ffffff80;
    
    // Focus animations (using opacity instead of scale)
    opacity: focused ? 1.0 : 0.8;
    animate background { duration: 200ms; }
    animate border-width { duration: 200ms; }
    animate opacity { duration: 200ms; }
    
    // Drop shadow effect
    Rectangle {
        x: 2px;
        y: 2px;
        width: parent.width;
        height: parent.height;
        border-radius: parent.border-radius;
        background: #00000040;
        z: -1;
    }

    VerticalBox {
        padding: 12px;
        spacing: 8px;
        
        // App icon placeholder
        Rectangle {
            height: large ? 80px : 60px;
            background: #667eea;
            border-radius: 6px;
            Text {
                text: app.name;
                color: white;
                font-size: large ? 32px : 24px;
                font-weight: 600;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // App name
        Text {
            text: app.name;
            color: white;
            font-size: large ? 16px : 14px;
            font-weight: 500;
            horizontal-alignment: center;
            overflow: elide;
        }
    }

    TouchArea {
        clicked => {
            root.clicked();
        }
    }
}

// Top navigation bar component
component TopBar inherits Rectangle {
    in property <int> current-tab;
    callback tab-clicked(int);
    height: 80px;
    background: #00000060;
    HorizontalBox {
        padding: 20px;
        spacing: 40px;
        alignment: center;
        
        // Logo/Title
        Text {
            text: "RanorTV";
            color: white;
            font-size: 24px;
            font-weight: 700;
            horizontal-alignment: center;
        }

        Rectangle { 
            // Spacer - use specific width instead of fr
            min-width: 100px;
        }
        
        // Tab buttons
        HorizontalBox {
            spacing: 30px;
            Rectangle {
                width: 80px;
                height: 40px;
                border-radius: 20px;
                background: current-tab == 0 ? #ffffff30 : transparent;
                animate background { duration: 200ms; }
                Text {
                    text: "Home";
                    color: current-tab == 0 ? white : #ffffff80;
                    font-size: 14px;
                    font-weight: current-tab == 0 ? 600 : 400;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                TouchArea {
                    clicked => {
                        root.tab-clicked(0);
                    }
                }
            }

            Rectangle {
                width: 80px;
                height: 40px;
                border-radius: 20px;
                background: current-tab == 1 ? #ffffff30 : transparent;
                animate background { duration: 200ms; }
                Text {
                    text: "Apps";
                    color: current-tab == 1 ? white : #ffffff80;
                    font-size: 14px;
                    font-weight: current-tab == 1 ? 600 : 400;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                TouchArea {
                    clicked => {
                        root.tab-clicked(1);
                    }
                }
            }

            Rectangle {
                width: 80px;
                height: 40px;
                border-radius: 20px;
                background: current-tab == 2 ? #ffffff30 : transparent;
                animate background { duration: 200ms; }
                Text {
                    text: "Store";
                    color: current-tab == 2 ? white : #ffffff80;
                    font-size: 14px;
                    font-weight: current-tab == 2 ? 600 : 400;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                TouchArea {
                    clicked => {
                        root.tab-clicked(2);
                    }
                }
            }

            Rectangle {
                width: 80px;
                height: 40px;
                border-radius: 20px;
                background: current-tab == 3 ? #ffffff30 : transparent;
                animate background { duration: 200ms; }
                Text {
                    text: "Settings";
                    color: current-tab == 3 ? white : #ffffff80;
                    font-size: 14px;
                    font-weight: current-tab == 3 ? 600 : 400;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                TouchArea {
                    clicked => {
                        root.tab-clicked(3);
                    }
                }
            }
        }
    }
}

// Featured section component (Apple TV style hero)
component FeaturedSection inherits Rectangle {
    in property <[AppItem]> apps;
    callback app-clicked(string);
    height: 400px;
    VerticalBox {
        spacing: 20px;
        Text {
            text: "Featured";
            color: white;
            font-size: 28px;
            font-weight: 700;
            horizontal-alignment: left;
        }

        ScrollView {
            height: 320px;
            HorizontalBox {
                spacing: 20px;
                padding: 10px;
                for app[i] in apps: AppTile {
                    app: app;
                    large: i == 0; // First app is larger
                    clicked => {
                        root.app-clicked(app.id);
                    }
                }
            }
        }
    }
}

// Grid section for apps
component AppGrid inherits Rectangle {
    in property <[AppItem]> apps;
    in property <string> title;
    callback app-clicked(string);
    VerticalBox {
        spacing: 20px;
        Text {
            text: title;
            color: white;
            font-size: 24px;
            font-weight: 600;
            horizontal-alignment: left;
        }

        ScrollView {
            VerticalBox {
                spacing: 20px;
                for app[i] in apps: AppTile {
                    app: app;
                    clicked => {
                        root.app-clicked(app.id);
                    }
                }
            }
        }
    }
}

// Settings panel
component SettingsPanel inherits Rectangle {
    VerticalBox {
        spacing: 30px;
        padding: 40px;
        Text {
            text: "Settings";
            color: white;
            font-size: 32px;
            font-weight: 700;
        }

        VerticalBox {
            spacing: 20px;
            Rectangle {
                height: 80px;
                border-radius: 8px;
                background: #ffffff10;
                HorizontalBox {
                    padding: 20px;
                    spacing: 20px;
                    VerticalBox {
                        spacing: 5px;
                        Text {
                            text: "Display & Sound";
                            color: white;
                            font-size: 18px;
                            font-weight: 600;
                        }

                        Text {
                            text: "Resolution, HDR, Audio output";
                            color: #ffffff80;
                            font-size: 14px;
                        }
                    }

                    Rectangle {
                        min-width: 50px; // Spacer
                    }

                    Text {
                        text: ">";
                        color: #ffffff60;
                        font-size: 20px;
                        vertical-alignment: center;
                    }
                }

                TouchArea {
                    // Handle settings item click
                }
            }

            Rectangle {
                height: 80px;
                border-radius: 8px;
                background: #ffffff10;
                HorizontalBox {
                    padding: 20px;
                    spacing: 20px;
                    VerticalBox {
                        spacing: 5px;
                        Text {
                            text: "Network";
                            color: white;
                            font-size: 18px;
                            font-weight: 600;
                        }

                        Text {
                            text: "Wi-Fi, Ethernet, VPN";
                            color: #ffffff80;
                            font-size: 14px;
                        }
                    }

                    Rectangle {
                        min-width: 50px; // Spacer
                    }

                    Text {
                        text: ">";
                        color: #ffffff60;
                        font-size: 20px;
                        vertical-alignment: center;
                    }
                }

                TouchArea {
                    // Handle settings item click
                }
            }

            Rectangle {
                height: 80px;
                border-radius: 8px;
                background: #ffffff10;
                HorizontalBox {
                    padding: 20px;
                    spacing: 20px;
                    VerticalBox {
                        spacing: 5px;
                        Text {
                            text: "System";
                            color: white;
                            font-size: 18px;
                            font-weight: 600;
                        }

                        Text {
                            text: "Updates, Storage, Restart";
                            color: #ffffff80;
                            font-size: 14px;
                        }
                    }

                    Rectangle {
                        min-width: 50px; // Spacer
                    }

                    Text {
                        text: ">";
                        color: #ffffff60;
                        font-size: 20px;
                        vertical-alignment: center;
                    }
                }

                TouchArea {
                    // Handle settings item click
                }
            }
        }
    }
}

// Main application window
export component AppWindow inherits Window {
    // Properties
    in-out property <int> current-tab: 0;
    in-out property <[AppItem]> featured-apps;
    in-out property <[AppItem]> installed-apps;
    in-out property <[AppItem]> store-apps;
    
    // Callbacks
    callback launch-app(string);
    callback navigate(string);
    callback switch-tab(int);
    callback refresh-store();
    
    // Window properties
    title: "RanorTV";
    background: #1a1a2e;
    
    // Keyboard handling
    FocusScope {
        key-pressed(event) => {
            if (event.text == Key.UpArrow) {
                root.navigate("up");
                return accept;
            } else if (event.text == Key.DownArrow) {
                root.navigate("down");
                return accept;
            } else if (event.text == Key.LeftArrow) {
                root.navigate("left");
                return accept;
            } else if (event.text == Key.RightArrow) {
                root.navigate("right");
                return accept;
            } else if (event.text == Key.Return) {
                root.navigate("select");
                return accept;
            }
            return reject;
        }
        VerticalBox {
            // Top navigation
            TopBar {
                current-tab: root.current-tab;
                tab-clicked(index) => {
                    root.current-tab = index;
                    root.switch-tab(index);
                }
            }
            
            // Main content area
            Rectangle {
                background: transparent;
                ScrollView {
                    padding: 40px;
                    VerticalBox {
                        spacing: 40px;
                        
                        // Content based on current tab
                        if current-tab == 0: VerticalBox {
                            spacing: 40px;
                            FeaturedSection {
                                apps: featured-apps;
                                app-clicked(id) => {
                                    root.launch-app(id);
                                }
                            }

                            AppGrid {
                                title: "Recently Used";
                                apps: installed-apps;
                                app-clicked(id) => {
                                    root.launch-app(id);
                                }
                            }
                        }
                        if current-tab == 1: AppGrid {
                            title: "All Apps";
                            apps: installed-apps;
                            app-clicked(id) => {
                                root.launch-app(id);
                            }
                        }
                        if current-tab == 2: VerticalBox {
                            spacing: 30px;
                            HorizontalBox {
                                Text {
                                    text: "App Store";
                                    color: white;
                                    font-size: 32px;
                                    font-weight: 700;
                                }

                                Rectangle {
                                    min-width: 100px; // Spacer
                                }

                                Button {
                                    text: "Refresh";
                                    clicked => {
                                        root.refresh-store();
                                    }
                                }
                            }

                            AppGrid {
                                title: "Available Apps";
                                apps: store-apps;
                                app-clicked(id) => {
                                    root.launch-app(id);
                                }
                            }
                        }
                        if current-tab == 3: SettingsPanel { }
                    }
                }
            }
        }
    }
}
