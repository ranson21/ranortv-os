// components/app_tile.slint

import { Button, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";
import { AppItem } from "app_item.slint";
import { Theme } from "../styles/theme.slint";

export component AppTile inherits Rectangle {
    in property <AppItem> app;
    in property <bool> focused: false;
    in property <bool> large: false;
    callback clicked();

    width: large ? 403px : 288px;  // 336 * 1.2 = 403, 240 * 1.2 = 288
    height: large ? 230px : 173px; // 192 * 1.2 = 230, 144 * 1.2 = 173
    border-radius: 20px;
    background: focused ? Theme.color-surface-focused : Theme.color-surface;
    border-width: 0px;
    border-color: Theme.color-text-muted;
    clip: true;  // Enable clipping

    // Focus animation
    opacity: focused ? 1.0 : 0.8;
    animate background { duration: 200ms; }
    animate border-width { duration: 200ms; }
    animate opacity { duration: 200ms; }


    // Full tile background image - positioned absolutely
    Image {
        source: app.icon;
        x: 0px;
        y: 0px;
        width: root.width;
        height: root.height;
        image-fit: fill;  // Stretch to fill exactly, may slightly distort
        image-rendering: smooth;
        z: -0.5;  // Behind the overlay but above the shadow
    }

    // Overlay for app name when focused
    if focused: Rectangle {
        width: parent.width;
        height: 30px;
        y: parent.height - 30px;
        clip: true;  // Enable clipping
        
        // Inner rectangle with full rounded corners, positioned to show only bottom corners
        Rectangle {
            width: parent.width;
            height: 60px;  // Taller than parent so top corners are clipped off
            y: -30px;      // Position so top half is above the clipping boundary
            background: Theme.color-shadow;
            border-radius: 15px;  // Match your image corner radius
        }

        Text {
            text: app.name;
            color: white;
            font-size: large ? Theme.font-size-body : Theme.font-size-sm;
            font-weight: 500;
            horizontal-alignment: center;
            vertical-alignment: center;
            overflow: elide;
            z: 1;  // Ensure text is above the background rectangles
            // Fade in animation
            animate opacity { duration: 200ms; }
        }
    }

    TouchArea {
        clicked => {
            root.clicked();
        }
    }
}
