import { AppItem } from "components/app_item.slint";
import { TopBar } from "components/top_bar.slint";
import { FeaturedSection } from "components/featured_section.slint";
import { AppGrid } from "components/app_grid.slint";
import { SettingsPanel } from "components/settings_panel.slint";
import { Theme } from "styles/theme.slint";

import { Button, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";

export component AppWindow inherits Window {
    in-out property <int> current-tab: 0;
    in-out property <[AppItem]> featured-apps;
    in-out property <[AppItem]> installed-apps;
    in-out property <[AppItem]> store-apps;

    // focus properties
    in-out property <int> featured-focus: 0;
    in-out property <int> apps-focus: 0;
    in-out property <int> store-focus: 0;
    
    // alignment property
    in-out property <bool> featured-top-aligned: false;

    // callbacks
    callback launch-app(string);
    callback navigate(string);
    callback switch-tab(int);
    callback refresh-store();
    callback focus-changed(int, int);

    title: "RanorTV";
    background: Theme.color-background;

    // Fullscreen configuration
    no-frame: true;              // Remove window decorations
    always-on-top: true;         // Keep on top (kiosk mode)

    FocusScope {
        key-pressed(event) => {
            if (event.text == Key.UpArrow) {
                root.navigate("up");
                return accept;
            }
            if (event.text == Key.DownArrow) {
                root.navigate("down");
                return accept;
            }
            if (event.text == Key.LeftArrow) {
                root.navigate("left");
                return accept;
            }
            if (event.text == Key.RightArrow) {
                root.navigate("right");
                return accept;
            }
            if (event.text == Key.Return) {
                root.navigate("select");
                return accept;
            }
            return reject;
        }

        Rectangle {
            width: 100%;
            height: 100%;
            FeaturedSection {
                apps: featured-apps;
                focused-index: root.featured-focus;
                width: 100%;
                height: 30%;
                
                // Use states for smooth native transitions
                states [
                    bottom when !root.featured-top-aligned: {
                        y: parent.height - self.height;
                        out {
                            animate y {
                                duration: 200ms;
                                easing: ease-out;
                            }
                        }
                    }
                    top when root.featured-top-aligned: {
                        y: 0px;
                        in {
                            animate y {
                                duration: 200ms;
                                easing: ease-in;
                            }
                        }
                        out {
                            animate y {
                                duration: 200ms;
                                easing: ease-out;
                            }
                        }
                    }
                ]
                app-clicked(id) => {
                    root.launch-app(id);
                }
                focus-changed(index) => {
                    root.featured-focus = index;
                    root.focus-changed(0, index);
                }
            }
        }
    }
}
